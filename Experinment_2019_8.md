# 7/15~ - Experiment for presentation of FAST-Zero and seminar

## 目的
認識補助インタフェースに対する客観的評価と主観的評価を実験検証を通して行う.

* **客観的評価**

    自律制御における，制御段階での操作介入(アクセルブレーキ)と，認識段階でのインタフェース介入にどのような差が現れるかを検証する.

* **主観的評価**

    NASA-TLXを用いて主観的評価を行う.

## 実験条件

* 被験者: 小型移動体の後ろに付いて操作を行う
* 走行経路 : 名古屋大学グリーンベルト

![route](./Picture/route2.png)


### シナリオ

周回　12周(5分)

### type-1

|周回|介入方法|歩行者|認識|車両|障害物|走行継続|
|:-:|:--|:--|:--|:--|:--|:--|
|1|Joy (練)|横断しない|成功|通過|経路脇||
|2|Joy (練)|横断する|成功|一時停止|経路上|自動発進|
|3|Joy|横断しない|成功|通過|経路脇||
|4|Joy|横断する|成功|一時停止|経路上|自動発進|
|5|Joy|横断しない|失敗|停止|経路上|アクセル|
|6|Joy|横断しない|成功|通過|経路脇||
|7|Joy|横断する|失敗|通過|経路脇|ブレーキ|
|8|Joy|横断する|成功|一時停止|経路上|自動発進|
||||||||
|9|RAS (練)|横断しない|成功||経路脇||
|10|RAS (練)|横断する|成功||経路上|自動移動|
|11|RAS|横断する|成功||経路上|自動移動|
|12|RAS|横断しない|失敗||経路上|スワイプ|
|13|RAS|横断しない|成功||経路脇||
|14|RAS|横断する|失敗||経路脇|スワイプ(戻す)|
|15|RAS|横断しない|成功||経路脇||
|16|RAS|横断しない|失敗||経路上|スワイプ|

### type-1-inv

|周回|介入方法|歩行者|認識|車両|障害物|走行継続|
|:-:|:--|:--|:--|:--|:--|:--|
|1|RAS (練)|横断しない|成功||経路脇||
|2|RAS (練)|横断する|成功||経路上|自動移動|
|3|RAS|横断する|成功||経路上|自動移動|
|4|RAS|横断しない|失敗||経路上|スワイプ|
|5|RAS|横断しない|成功||経路脇||
|6|RAS|横断する|失敗||経路脇|スワイプ(戻す)|
|7|RAS|横断しない|成功||経路脇||
|8|RAS|横断しない|失敗||経路上|スワイプ|
||||||||
|9|Joy (練)|横断しない|成功|通過|経路脇||
|10|Joy (練)|横断する|成功|一時停止|経路上|自動発進|
|11|Joy|横断しない|成功|通過|経路脇||
|12|Joy|横断する|成功|一時停止|経路上|自動発進|
|13|Joy|横断しない|失敗|停止|経路上|アクセル|
|14|Joy|横断しない|成功|通過|経路脇||
|15|Joy|横断する|失敗|通過|経路脇|ブレーキ|
|16|Joy|横断する|成功|一時停止|経路上|自動発進|

### type-2

|周回|介入方法|歩行者|認識|車両|障害物|走行継続|
|:-:|:--|:--|:--|:--|:--|:--|
|1|Joy (練)|横断しない|成功|通過|経路脇||
|2|Joy (練)|横断する|成功|一時停止|経路上|自動発進|
|3|Joy|横断する|成功|一時停止|経路上|自動発進|
|4|Joy|横断しない|成功|通過|経路脇||
|5|Joy|横断しない|成功|通過|経路脇||
|6|Joy|横断する|成功|一時停止|経路上|自動発進|
|7|Joy|横断しない|失敗|停止|経路上|アクセル|
|8|Joy|横断する|失敗|通過|経路脇|ブレーキ|
||||||||
|9|RAS (練)|横断しない|成功||経路脇||
|10|RAS (練)|横断する|成功||経路上|自動移動|
|11|RAS|横断しない|失敗||経路上|スワイプ|
|12|RAS|横断する|失敗||経路脇|スワイプ(戻す)|
|13|RAS|横断する|成功||経路上|自動移動|
|14|RAS|横断しない|失敗||経路上|スワイプ|
|15|RAS|横断しない|成功||経路脇||
|16|RAS|横断しない|成功||経路脇||

### type-2-inv

|周回|介入方法|歩行者|認識|車両|障害物|走行継続|
|:-:|:--|:--|:--|:--|:--|:--|
|1|RAS (練)|横断しない|成功||経路脇||
|2|RAS (練)|横断する|成功||経路上|自動移動|
|3|RAS|横断しない|失敗||経路上|スワイプ|
|4|RAS|横断する|失敗||経路脇|スワイプ(戻す)|
|5|RAS|横断する|成功||経路上|自動移動|
|6|RAS|横断しない|失敗||経路上|スワイプ|
|7|RAS|横断しない|成功||経路脇||
|8|RAS|横断しない|成功||経路脇||
||||||||
|9|Joy (練)|横断しない|成功|通過|経路脇||
|10|Joy (練)|横断する|成功|一時停止|経路上|自動発進|
|11|Joy|横断する|成功|一時停止|経路上|自動発進|
|12|Joy|横断しない|成功|通過|経路脇||
|13|Joy|横断しない|成功|通過|経路脇||
|14|Joy|横断する|成功|一時停止|経路上|自動発進|
|15|Joy|横断しない|失敗|停止|経路上|アクセル|
|16|Joy|横断する|失敗|通過|経路脇|ブレーキ|

<!-- |介入方法|Joy|RAS|
|:-:|:--|:--|
|車両制御|横断したい歩行者に対して → 5秒停止 <br>横断しない歩行者に対して → 通過 <br>← 各動作は予め指定してcsvファイルから読み込み|インタフェースに表示された障害物を認識しながら自律走行
|被験者|自動運転を行う車両に対してブレーキ(LB)とアクセル(RB)を操作することで速度を制御.|iPadで障害物を操作 -->

|介入方法|Joy|RAS|
|:-:|:--|:--|
|車両制御|インタフェースに表示された障害物を認識しながら自律走行|インタフェースに表示された障害物を認識しながら自律走行
|被験者|自動運転を行う車両に対してブレーキ(LB)とアクセル(RB)を操作することで速度を制御.|iPadで障害物を操作

## 実験手順

1. 実験の説明

    1. 実験目的

        自動運転システムへの，手動での制御段階での介入と，認識補助インタフェースでの認識段階での介入における車両制御の違いを観察する．

    1. 実験流れ

        12周を走行する.

        1. 2周練習　(間違った認識を補助する練習←停止しそうなのを動かす，通過しそうなのを止める)

        1. 6周: Joystickを使って制御へ介入

        1. 手動介入に関するアンケート

        1. 2周練習　(間違った認識を補助する練習←停止しそうなのを動かす，通過しそうなのを止める)

        1. 6周: RASを使って認識段階に介入

        1. 認識介入に関するアンケート

    1. シナリオ

        周回の中間地点に歩行者が立っている．車両はその条件下で走行を行う

        * 歩行者

            歩行者は配置場所で，車両経路を渡ろうとしたり，ただ単に突っ立っていたりする．

        * 車両

            歩行者を認識し，横断するかしないかを予測し適切な走行を行う．ただしたまにミスる．渡らなそうな歩行者に対して止まったり(スムーズな運転ではない)，渡ろうとしている歩行者に対してそのまま脇を通過しようとする(安全な走行ではない)．

    1. 被験者のタスクと目標

        joyでもRASでもできるだけ最低限の介入で，車両を安全かつスムーズに走行させる．→ 不自然に停止させない．歩行者が渡りそうだったら渡らせる．

        * できるだけロボットにくっつくようにして追従して欲しい <- ロボットの速度変化が分かりやすくするようにしたい

1. 操作練習(制御介入, 認識介入)

    1. 制御介入

        自動運転システムは歩行者を検出・意図を推定しながら走行する．歩行者が横断しそうと判断したら4m手前で停止する．たまに認識を失敗するので，不必要に止まりそうだったらアクセルを踏んで速度を維持，停止するべきなのにしなさそうだったらブレーキを踏んで停止させる．

        **できるだけ車両に介入せずに自律走行を行わせ，"安全"かつ"スムーズ"に走らせる事**

    1. 認識介入

        自動運転システムは歩行者を検出・意図を推定しながら走行する．そして自動運転の認識情報を画面に表示させ，被験者と共有する．歩行者が渡ると認識したらBOXは経路上に表示され，4m手前で停止する．渡らないと認識したら緑のBOXは経路脇に表示される．自動運転システムはたまに認識に失敗するので，認識を間違っていたらそのBOXを被験者が操作して補助する．渡らないのにBOXが経路上に置いてあったら脇にどかす，渡ろうとしているのに脇に置いてあったら経路上に戻す．

        **車両を"安全"かつ"スムーズ"に走らせる事**

1. 走行実験

1. アンケート

    → NASA-TLX で主観評価

## 7/18 反省
### システム

* ~~roslaunch 使いたい~~

* ~~Joyの調子が悪い~~ → joyの初期値が意図しないものになっている．加速値を前速度に追加していく形をとっていたので，アクセルを離しても減速しない．どうしようもないのでトリガーと速度を線形な関係に戻す．逆にこっちの方が自然かもしれない．

* ~~ファイル読み込みはyamlでやりたい~~ → yamlで読み込み，周回の初期値も設定できる

* ~~B button -> scenario モードはナンセンス~~ → 最初からscenario走行可能(CSvに依る)

* ~~Joy抜ける~~ → 被験者にはできるだけロボットに近付いて歩行してもらう.

### 実験条件

* ~~歩行者が渡る回数が少ない~~ → 半分くらいまで増やした

* 段取りよくやりたい

    被験者の目標設定をはっきり言う → **車両を"安全"かつ"スムーズ"に走らせる事**

    歩行者が渡りそうになかったら止まらずに走行．歩行者が渡りそうだったら安全に止まる.

~~システムの説明が不十分~~ → スライドで具体的に説明，実際に2周(正常に認識した場合のみ)して練習させる．
* Joy

* RAS

    自動運転システムが歩行者が渡らないと判断したら，BoundingBoxは横にはけられてしまう．もし歩行者が渡りそうだった場合はそれを元に戻す必要があること.
    ~~→そもそもこれって必要？搭乗者は周辺環境のリスク全てを把握する必要がないのがこのシステムの強みなのでは？~~
    → やめた

### 主観評価

トグルの操作感が悪い

質問に対してトグルをどっちに動かしたらいいか分からない

## 7/26 反省

### システム

* ~~減速開始距離についてしっかり決めたほうがいい~~ → 実車両の理想的な減速における停止時間を元に減速時の加速度を設定

* ~~減速を認知するのが難しい~~ → 被験者にはロボットにピッタリくっつくようにして歩行してもらう

* ~~自動でスワイプしないのか~~

* 認識介入において認識状態の提示が10m手前で行われるのならば，制御介入時も10m手前から減速したほうがフェアじゃない?

* ~~SSD容量オーバーでデータ消失~~ → image_colorはやめた

* 毎週回ごとに停止する

* ~~暗くて何も見えなくなる~~ → 歩行者の位置を変更

* 歩行者の位置を周回ごとに変化させたほうがいいんじゃないか

### data processing

* save data from rosbag to csv.

```bash
rostopic echo -b xxx.bag -p /topic/name > xxx.csv

```
ndt_pose, managed_obstacles, shifted_info, ypspur_ros/odom
